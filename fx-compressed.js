/*
 * FX v3.0
 * Copyright (c) 2011 Ryan Morr (ryanmorr.com)
 * Licensed under the MIT license.
 */

(function(win){var doc=win.document,view=doc.defaultView,toString=Object.prototype.toString,cache={},empty=function(){},getStyle,hex6=(/^#(\w{2})(\w{2})(\w{2})$/),hex3=(/^#(\w{1})(\w{1})(\w{1})$/),rgb=(/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/),FX=win.FX=function(el,attributes,duration,transition,callback,ctx){this.el=getElement(el);this.attributes=attributes;this.duration=duration||0.7;this.transition=FX.transitions[transition||'easeInOut'];this.callback=callback||empty;this.ctx=ctx||win;this.animating=false;this.units={};this.frame={};this.endAttr={};this.startAttr={}};FX.transitions={linear:function(t,b,c,d){return c*t/d+b},easeIn:function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},easeOut:function(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},easeInOut:function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b}};FX.prototype={start:function(){var fx=this;fx.getAttributes();fx.duration=fx.duration*1000;fx.time=now();fx.animating=true;fx.timer=setInterval(function(){var time=now();if(time<(fx.time+fx.duration)){fx.elapsed=time-fx.time;fx.setCurrentFrame()}else{fx.frame=fx.endAttr;fx.complete()}fx.setAttributes()},10)},stop:function(finish){if(finish){this.frame=this.endAttr;this.setAttributes()}this.complete()},isAnimating:function(){return this.animating},ease:function(start,end){return this.transition(this.elapsed,start,end-start,this.duration)},complete:function(){clearInterval(this.timer);this.timer=null;this.animating=false;this.callback.call(this.ctx)},setCurrentFrame:function(){var start,end;for(var attr in this.startAttr){start=this.startAttr[attr];end=this.endAttr[attr];if(isArray(start)){this.frame[attr]=[];for(var i=0,len=start.length;i<len;i++){this.frame[attr][i]=this.ease(start[i],end[i])}}else{this.frame[attr]=this.ease(start,end)}}},getAttributes:function(){var attr,attributes,el=this.el;for(attr in this.attributes){attributes=this.attributes[attr];switch(attr){case'color':case'borderColor':case'border-color':case'backgroundColor':case'background-color':this.startAttr[attr]=parseColor(attributes.from||getStyle(el,attr));this.endAttr[attr]=parseColor(attributes.to);break;case'scrollTop':case'scrollLeft':el=this.el=(el==doc.body)?(doc.documentElement||doc.body):el;this.startAttr[attr]=attributes.from||el[attr];this.endAttr[attr]=attributes.to;break;default:var end=attributes.to,units=attributes.units||"px",start=('from'in attributes)?attributes.from:getStartValue(el,attr,end,units);this.units[attr]=units;this.endAttr[attr]=end;this.startAttr[attr]=start}}},setAttributes:function(){var attr,frame,units,el=this.el;for(attr in this.frame){frame=this.frame[attr];units=this.units[attr];switch(attr){case'opacity':setStyle(el,attr,frame);break;case'scrollLeft':case'scrollTop':el[attr]=frame;break;case'color':case'borderColor':case'border-color':case'backgroundColor':case'background-color':setStyle(el,attr,'rgb('+Math.floor(frame[0])+','+Math.floor(frame[1])+','+Math.floor(frame[2])+')');break;default:setStyle(el,attr,frame+units)}}}};function getElement(id){return(typeof id=="string")?doc.getElementById(id):id}function setStyle(el,prop,value){if(prop=='opacity'){el.style.filter="alpha(opacity="+value*100+")";el.style.opacity=value}else{prop=toCamelCase(prop);el.style[prop]=value}}if(!!view&&'getComputedStyle'in view){getStyle=function(el,prop){prop=toCamelCase(prop);return view.getComputedStyle(el,"")[prop]||null}}else{getStyle=function(el,prop){if(prop=='opacity'){value=100;try{value=el.filters['DXImageTransform.Microsoft.Alpha'].opacity}catch(e){try{value=el.filters('alpha').opacity}catch(e){}}value=isNaN(value)?100:(value||0);return value/100}prop=toCamelCase(prop);return el.currentStyle[prop]||null}}FX.getStyle=getStyle;function getStartValue(el,attr,end,units){var start=parseFloat(getStyle(el,attr))||0;if(units!="px"&&view){setStyle(el,attr,(end||1)+units);start=((end||1)/parseFloat(getStyle(el,attr)))*start;setStyle(el,attr,start+units)}return start}function toCamelCase(str){if(str in cache){return cache[str]}var parts=str.split('-'),camel=parts[0],len=parts.length;if(len>1){for(var i=1;i<len;i++){camel+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1)}}return cache[str]=camel}function parseColor(str){if(str in cache){return cache[str]}var color=str.match(hex6);if(color&&color.length==4){return cache[str]=[parseInt(color[1],16),parseInt(color[2],16),parseInt(color[3],16)]}color=str.match(rgb);if(color&&color.length==4){return cache[str]=[parseInt(color[1],10),parseInt(color[2],10),parseInt(color[3],10)]}color=str.match(hex3);if(color&&color.length==4){return cache[str]=[parseInt(color[1]+color[1],16),parseInt(color[2]+color[2],16),parseInt(color[3]+color[3],16)]}}var isArray=Array.isArray||function(o){return toString.call(o)==='[object Array]'},now=Date.now||function(){return new Date().getTime()}})(this);